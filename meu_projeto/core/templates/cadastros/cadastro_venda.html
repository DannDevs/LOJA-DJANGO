<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Venda</title>
    {% load static %}
    <link rel="stylesheet" href="{%static 'venda.css'%}">
</head>
<body>
    {% include 'components/navbar.html'%}
    <div class="divcentralc">
        <div class="retornarpag">
            <button class="buttonp" ><a href="{% url 'vendas' %}">Return</a></button>
        </div>
        <div class="cadastro">
         <div class="cadastro col-md-5 mx-auto">
    <form method="post" class="row g-3 p-4 rounded shadow-sm bg-dark text-light">
        {% csrf_token %}

        <h4 class="fw-bold text-primary">Pedido De Venda</h4>
        {% if itensvenda %}

        <div class="col-md-12">
            <label class="form-label">Código</label>
            <input type="number" name="codigo" value="{{ ven_atual.codigo }}" class="form-control" disabled>
        </div>

        <div class="col-md-12">
            <label class="form-label">Cliente</label>
            <input type="text" name="cliente" value="{{ven_atual.cliente.codigo}} - {{ven_atual.cliente.nome}}" class="form-control" disabled>
        </div>

        <div class="col-md-12">
            <label class="form-label">Vendedor</label>
            <input type="text" name="vendedor" value="{{ven_atual.vendedor.codigo}} - {{ven_atual.vendedor.nome}}" class="form-control" disabled>
        </div>
        <div class="col-12 mt-4">
            <h4 class="fw-bold text-primary text-start">Itens Da Venda</h4>
        </div>

        <div class="col-md-12">
            <label class="form-label">Produto</label>
            <select name="produto" class="form-select">
                <option value="">Selecione...</option>
                {% for p in produtos %}
                    <option value="{{ p.id }}">{{ p.codigo }} - {{ p.descricao }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-6">
            <label class="form-label">Preço Unitário</label>
            <input type="number" name="preco_unitario" class="form-control">
        </div>

        <div class="col-md-6">
            <label class="form-label">Quantidade</label>
            <input type="number" name="quantidade" class="form-control">
        </div>
  
        <button type="submit" class="btn btn-secondary" name="add_item_apos">Adicionar Item</button>
        {% else %}
                <div class="col-md-12">
            <label class="form-label">Código</label>
            <input type="number" name="codigo" class="form-control" required>
        </div>

        <div class="col-md-12">
            <label class="form-label">Cliente</label>
            <select name="cliente" class="form-select" required>
                <option value="">Selecione...</option>
                {% for c in clientes %}
                    <option value="{{ c.id }}">{{ c.codigo }} - {{ c.nome }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-12">
            <label class="form-label">Vendedor</label>
            <select name="vendedor" class="form-select" required>
                <option value="">Selecione...</option>
                {% for v in vendedores %}
                    <option value="{{ v.id }}">{{ v.codigo }} - {{ v.nome }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-12 mt-4">
            <h4 class="fw-bold text-primary text-start">Itens Da Venda</h4>
        </div>

        <div class="col-md-12">
            <label class="form-label">Produto</label>
            <select name="produto" class="form-select" required>
                <option value="">Selecione...</option>
                {% for p in produtos %}
                    <option value="{{ p.id }}">{{ p.codigo }} - {{ p.descricao }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-6">
            <label class="form-label">Preço Unitário</label>
            <input type="number" name="preco_unitario" class="form-control" required>
        </div>

        <div class="col-md-6">
            <label class="form-label">Quantidade</label>
            <input type="number" name="quantidade" class="form-control" required>
        </div>
  
        <button type="submit" class="btn btn-secondary" name="add_item">Adicionar Item</button>
        {% endif %}
        
        <div class="col-12 text-end mt-3">
            
            <a href="{% url 'vendas' %}" class="btn btn-secondary">Cancelar</a>
            <button type="submit" class="btn btn-success" name="add_venda">Salvar</button>
        </div>
    </form>
</div>

<!-- GRID DE PRODUTOS DA VENDA -->
<div class="row mt-5 p-4 col-md-7 mx-auto text-light">
    <h4 class="fw-bold text-center mb-3">Produtos Adicionados</h4>

    <table class="table table-dark">
        <thead>
            <tr>
                <th>Código</th>
                <th>Descrição</th>
                <th>Preço</th>
                <th>Quantidade</th>
            </tr>
        </thead>
        <tbody>
            {% for item in itensvenda %}
            <tr>
                <td>{{ item.produto.codigo }}</td>
                <td>{{ item.produto.descricao }}</td>
                <td>{{ item.preco_unitario }}</td>
                <td>{{ item.quantidade }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center text-muted">Nenhum item adicionado ainda.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

            {% if erro %}
                <p style="color: red; font-weight: bold;">  {{erro}} </p>
            {% elif sucesso %}
                <p style="color: green;font-weight: bold;">{{sucesso}}</p>
            {% endif%}
           
        </div>
    </div>
</body>
</html>